<?xml version="1.0" encoding="utf-8" ?>
<controls:Page 
   xmlns="http://xamarin.com/schemas/2014/forms"
   xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
   xmlns:controls="clr-namespace:ComicsShelf.Helpers.Controls"
   x:Class="ComicsShelf.Folder.FolderPage">
   <controls:Page.Content>
      <ScrollView Orientation="Vertical" VerticalOptions="FillAndExpand">
         <StackLayout VerticalOptions="StartAndExpand" HorizontalOptions="FillAndExpand" Margin="0" Padding="0" Spacing="0">

            <StackLayout.Resources>
               <ResourceDictionary>

                  <Style TargetType="controls:ListView">
                     <Setter Property="Margin" Value="0" />
                     <Setter Property="Padding" Value="4,4,4,0" />
                     <Setter Property="HorizontalOptions" Value="Fill" />
                     <Setter Property="VerticalOptions" Value="Fill" />
                  </Style>

                  <Style TargetType="AbsoluteLayout">
                     <Setter Property="Margin" Value="6" />
                  </Style>
                  
                  <Style TargetType="Grid">
                     <Setter Property="BackgroundColor" Value="#9FA8DA" />
                     <Setter Property="Padding" Value="4" />
                     <Setter Property="AbsoluteLayout.LayoutBounds" Value="0,0,1,1" />
                     <Setter Property="AbsoluteLayout.LayoutFlags" Value="All" />
                  </Style>

                  <Style TargetType="StackLayout" >
                     <Setter Property="Margin" Value="0" />
                     <Setter Property="Padding" Value="0" />
                     <Setter Property="VerticalOptions" Value="FillAndExpand" />
                     <Setter Property="AbsoluteLayout.LayoutBounds" Value="0,0,1,1" />
                     <Setter Property="AbsoluteLayout.LayoutFlags" Value="All" />
                  </Style>

                  <Style TargetType="Image" x:Key="ImageFile" >
                     <Setter Property="HorizontalOptions" Value="Center" />
                     <Setter Property="VerticalOptions" Value="Start" />
                     <Setter Property="Aspect" Value="AspectFit" />
                  </Style>

                  <Style TargetType="Image" x:Key="ImageFolder" >
                     <Setter Property="HorizontalOptions" Value="FillAndExpand" />
                     <Setter Property="VerticalOptions" Value="Start" />
                     <Setter Property="Aspect" Value="AspectFill" />
                  </Style>

                  <Style TargetType="ProgressBar">
                     <Setter Property="HorizontalOptions" Value="Fill" />
                     <Setter Property="VerticalOptions" Value="Start" />
                     <Setter Property="Opacity" Value="0.75" />
                  </Style>

                  <Style TargetType="ContentView">
                     <Setter Property="Padding" Value="2" />
                     <Setter Property="BackgroundColor" Value="#9FA8DA" />
                     <Setter Property="Opacity" Value="0.85" />
                     <Setter Property="HorizontalOptions" Value="Fill" />
                     <Setter Property="VerticalOptions" Value="EndAndExpand" />
                  </Style>

                  <Style TargetType="Label" x:Key="ItemTitle">
                     <Setter Property="TextColor" Value="#FFFFFF" />
                     <Setter Property="HorizontalOptions" Value="Center" />
                     <Setter Property="LineBreakMode" Value="TailTruncation" />
                     <Setter Property="FontAttributes" Value="Bold" />
                  </Style>

               </ResourceDictionary>
            </StackLayout.Resources>

            <controls:ListView 
               IsVisible="{Binding HasRecentFiles}" Columns="5" 
               ItemTappedCommand="{Binding FileTappedCommand}"
               ItemsSource="{Binding Data.RecentFiles}">
               <controls:ListView.ItemTemplate>
                  <DataTemplate>

                     <!-- <controls:CoverFile DataSource="{Binding .}" /> -->
                     <AbsoluteLayout>
                        <Grid HeightRequest="200">
                           <Image Source="{Binding CoverPath}" Style="{StaticResource ImageFile}" />
                        </Grid>
                        <StackLayout>
                           <ProgressBar Progress="{Binding ReadingPercent}" />
                           <ContentView>
                              <Label Text="{Binding SmallText}" Style="{StaticResource ItemTitle}" />
                           </ContentView>
                        </StackLayout>
                     </AbsoluteLayout>

                  </DataTemplate>
               </controls:ListView.ItemTemplate>
            </controls:ListView>

            <controls:ListView
               IsVisible="{Binding HasFolders}" Columns="3" 
               ItemTappedCommand="{Binding FolderTappedCommand}"
               ItemsSource="{Binding Data.Folders}">
               <controls:ListView.ItemTemplate>
                  <DataTemplate>

                     <!-- <controls:CoverFolder DataSource="{Binding .}" />-->
                     <AbsoluteLayout>
                        <Grid HeightRequest="150">
                           <Image Source="{Binding CoverPath}" Style="{StaticResource ImageFolder}" />
                        </Grid>
                        <StackLayout>
                           <ProgressBar Progress="{Binding ReadingPercent}" />
                           <ContentView>
                              <Label Text="{Binding Text}" Style="{StaticResource ItemTitle}" />
                           </ContentView>
                        </StackLayout>
                     </AbsoluteLayout>

                  </DataTemplate>
               </controls:ListView.ItemTemplate>
            </controls:ListView>

            <controls:ListView
               IsVisible="{Binding HasFiles}" Columns="5" 
               ItemTappedCommand="{Binding FileTappedCommand}"
               ItemsSource="{Binding Data.Files}">
               <controls:ListView.ItemTemplate>
                  <DataTemplate>

                     <AbsoluteLayout>
                        <Grid HeightRequest="200">
                           <Image Source="{Binding CoverPath}" Style="{StaticResource ImageFile}" />
                        </Grid>
                        <StackLayout>
                           <ProgressBar Progress="{Binding ReadingPercent}" />
                           <ContentView>
                              <Label Text="{Binding SmallText}" Style="{StaticResource ItemTitle}" />
                           </ContentView>
                        </StackLayout>
                     </AbsoluteLayout>
                     
                  </DataTemplate>
               </controls:ListView.ItemTemplate>
            </controls:ListView>
            
         </StackLayout>
      </ScrollView>
   </controls:Page.Content>
</controls:Page>